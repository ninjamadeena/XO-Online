<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>XO Online - Ninja Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --box-color: #16213e;
            --accent-green: #0f3460;
            --highlight: #e94560;
            --text-color: #ecf0f1;
            --x-color: #ff2e63;
            --o-color: #08d9d6;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at top right, #2c2c54, var(--bg-color));
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
            user-select: none; /* ‡∏Å‡∏±‡∏ô User ‡∏•‡∏≤‡∏Å‡∏Ñ‡∏•‡∏∏‡∏°‡∏î‡∏≥ */
            -webkit-tap-highlight-color: transparent;
        }

        h1 {
            font-family: 'Fredoka One', cursive;
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0px #000;
            letter-spacing: 2px;
        }
        
        h1 span { color: var(--highlight); }

        .container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            text-align: center;
            width: 90%;
            max-width: 400px;
            transition: all 0.3s ease;
        }

        .hidden { display: none !important; }

        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
            font-family: 'Kanit', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .btn:active { transform: scale(0.95); }

        .btn-green { background: linear-gradient(45deg, #11998e, #38ef7d); color: white; box-shadow: 0 4px 15px rgba(56, 239, 125, 0.4); }
        .btn-blue { background: linear-gradient(45deg, #2193b0, #6dd5ed); color: white; box-shadow: 0 4px 15px rgba(33, 147, 176, 0.4); }
        .btn-orange { background: linear-gradient(45deg, #f12711, #f5af19); color: white; box-shadow: 0 4px 15px rgba(245, 175, 25, 0.4); }

        input[type="text"] {
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 12px;
            border: 2px solid #333;
            background: #0f3460;
            color: white;
            font-size: 1.2rem;
            text-align: center;
            box-sizing: border-box;
            outline: none;
            text-transform: uppercase;
        }
        input[type="text"]:focus { border-color: var(--o-color); }

        #game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px auto;
            max-width: 320px;
        }

        .cell {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Fredoka One', cursive;
            font-size: 4rem;
            cursor: pointer;
            transition: background 0.2s;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        .cell:hover { background: rgba(255, 255, 255, 0.2); }
        
        .cell.x { color: var(--x-color); text-shadow: 0 0 15px var(--x-color); }
        .cell.o { color: var(--o-color); text-shadow: 0 0 15px var(--o-color); }

        #status { font-size: 1.5rem; margin-bottom: 5px; font-weight: bold; }
        #room-info { font-size: 0.9rem; color: #aaa; background: rgba(0,0,0,0.3); padding: 5px 15px; border-radius: 20px; display: inline-block; margin-bottom: 15px;}
        
        #waiting { font-size: 1.2rem; color: var(--o-color); animation: pulse 1.5s infinite; margin-top: 15px; }

        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        
        @media (max-width: 400px) {
            h1 { font-size: 2.5rem; }
            .cell { font-size: 3rem; }
        }
    </style>
</head>
<body>

    <h1>‚ùå XO <span>On</span>line</h1>

    <div class="container">
        <div id="menu">
            <button class="btn btn-green" onclick="findMatch()">üöÄ ‡∏™‡∏∏‡πà‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà (Auto)</button>
            <div style="display: flex; align-items: center; margin: 15px 0; color: #aaa;">‚Äî‚Äî ‡∏´‡∏£‡∏∑‡∏≠ ‚Äî‚Äî</div>
            <button class="btn btn-blue" onclick="createRoom()">üè† ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
            
            <div style="margin-top: 20px; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 15px;">
                <input type="text" id="roomIdInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô" maxlength="6">
                <button class="btn btn-orange" onclick="joinRoom()" style="margin:0;">‚û°Ô∏è ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</button>
            </div>
            
            <div id="waiting" class="hidden">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏π‡πà‡∏ï‡πà‡∏≠‡∏™‡∏π‡πâ...</div>
        </div>

        <div id="game" class="hidden">
            <div id="room-info">Room ID: -</div>
            <div id="status">‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°...</div>
            
            <div id="game-board">
                <div class="cell" onclick="move(0)"></div>
                <div class="cell" onclick="move(1)"></div>
                <div class="cell" onclick="move(2)"></div>
                <div class="cell" onclick="move(3)"></div>
                <div class="cell" onclick="move(4)"></div>
                <div class="cell" onclick="move(5)"></div>
                <div class="cell" onclick="move(6)"></div>
                <div class="cell" onclick="move(7)"></div>
                <div class="cell" onclick="move(8)"></div>
            </div>
            
            <button class="btn btn-orange" onclick="location.reload()" style="margin-top: 20px;">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà URL ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Render ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á)
        const socket = io();
        
        let mySymbol = null;
        let currentTurn = 'X';
        let myRoomId = null;
        let isMyTurn = false;

        function findMatch() {
            document.getElementById('waiting').classList.remove('hidden');
            document.getElementById('waiting').innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏π‡πà‡∏ï‡πà‡∏≠‡∏™‡∏π‡πâ...";
            socket.emit('find_match');
        }

        function createRoom() {
            socket.emit('create_room');
        }

        function joinRoom() {
            const id = document.getElementById('roomIdInput').value;
            if(id) socket.emit('join_room', id);
            else alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
        }

        function move(index) {
            if (!isMyTurn || currentTurn !== mySymbol) return;
            socket.emit('make_move', { roomId: myRoomId, index: index, symbol: mySymbol });
        }

        // --- Event Listeners ---

        socket.on('room_created', (roomId) => {
            document.getElementById('waiting').classList.remove('hidden');
            document.getElementById('waiting').innerText = `‡∏´‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: ${roomId}\n(‡∏£‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ)`;
            
            // Auto copy to clipboard (‡∏ñ‡πâ‡∏≤ Browser ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö)
            if(navigator.clipboard) {
                navigator.clipboard.writeText(roomId).then(() => {
                    alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß: ' + roomId);
                }).catch(() => {});
            }
        });

        socket.on('game_start', (data) => {
            mySymbol = data.symbol;
            myRoomId = data.roomId;
            document.getElementById('menu').classList.add('hidden');
            document.getElementById('game').classList.remove('hidden');
            document.getElementById('room-info').innerText = `Room: ${myRoomId} | ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ ${mySymbol}`;
            updateStatus();
        });

        socket.on('update_board', (data) => {
            const cells = document.querySelectorAll('.cell');
            data.board.forEach((val, i) => {
                cells[i].innerText = val || '';
                cells[i].classList.remove('x', 'o');
                if (val === 'X') cells[i].classList.add('x');
                if (val === 'O') cells[i].classList.add('o');
            });
            currentTurn = data.turn;
            updateStatus();
        });

        socket.on('game_over', (data) => {
            setTimeout(() => {
                if(data.isDisconnect) {
                    alert('‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á‡∏´‡∏•‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠! ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞! üèÜ');
                } else if (data.winner === 'Draw') {
                    alert('‡πÄ‡∏™‡∏°‡∏≠! (Draw) ‡πÄ‡∏Å‡∏°‡∏ï‡∏∂‡∏á‡∏à‡∏±‡∏î‡πÜ');
                } else {
                    alert(data.winner === mySymbol ? 'üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞!' : 'üíÄ ‡πÅ‡∏û‡πâ‡πÅ‡∏•‡πâ‡∏ß! ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞');
                }
                location.reload();
            }, 100);
        });

        socket.on('error_msg', (msg) => alert(msg));

        function updateStatus() {
            isMyTurn = (mySymbol === currentTurn);
            const statusEl = document.getElementById('status');
            if (isMyTurn) {
                statusEl.innerText = "‚ö° ‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß!";
                statusEl.style.color = "#38ef7d";
            } else {
                statusEl.innerText = "‚è≥ ‡∏£‡∏≠‡∏ù‡πà‡∏≤‡∏¢‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°...";
                statusEl.style.color = "#ff2e63";
            }
        }
    </script>
</body>
</html>
